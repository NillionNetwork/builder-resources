<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wasm Bindgen Example</title>
  <script type="module">
    import * as nillion from "./node_modules/@nillion/nillion-client-js-browser/nillion_client_js_browser.js";

    async function runApp() {
      console.log(`run the default init`);
      await nillion.default();

      // load fixture config from bootstrap
      let response = await fetch("./local.json");

      // Check if the load was successful
      if (!response.ok) {
        throw new Error("FATAL: loading local.json config");
      }
      let config = await response.json();

      var userkey = nillion.UserKey.generate();
      var nodekey = nillion.NodeKey.from_seed("this is a test");
      const client = new nillion.WasmNillionClient(
        userkey,
        nodekey,
        config.bootnodes,
        false,
        config.payments_config,
      );
      const status = await client.cluster_information(config.cluster_id);
      console.log(`here is the cluster status result:`);
      console.log(JSON.stringify(status, null, 4));

      const party_id = await client.party_id();
      document.getElementById('content').textContent = party_id;
    }
    runApp();
  </script>
</head>

<body>
  <h1>WASM Bindgen Example</h1>
  <p>Check the console for output from the WebAssembly module.</p>
  <p id="content">Loading party id...</p>
</body>

</html>
